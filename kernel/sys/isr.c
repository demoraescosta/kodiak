#include "isr.h"
#include "idt.h"

void isr_init(void)
{
	idt_set_desc(0, isr0, 0);
	idt_set_desc(1, isr1, 0);
	idt_set_desc(2, isr2, 0);
	idt_set_desc(3, isr3, 0);
	idt_set_desc(4, isr4, 0);
	idt_set_desc(5, isr5, 0);
	idt_set_desc(6, isr6, 0);
	idt_set_desc(7, isr7, 0);
	idt_set_desc(8, isr8, 0);
	idt_set_desc(9, isr9, 0);
	idt_set_desc(10, isr10, 0);
	idt_set_desc(11, isr11, 0);
	idt_set_desc(12, isr12, 0);
	idt_set_desc(13, isr13, 0);
	idt_set_desc(14, isr14, 2);
	idt_set_desc(15, isr15, 0);
	idt_set_desc(16, isr16, 0);
	idt_set_desc(17, isr17, 0);
	idt_set_desc(18, isr18, 0);
	idt_set_desc(19, isr19, 0);
	idt_set_desc(20, isr20, 0);
	idt_set_desc(21, isr21, 0);
	idt_set_desc(22, isr22, 0);
	idt_set_desc(23, isr23, 0);
	idt_set_desc(24, isr24, 0);
	idt_set_desc(25, isr25, 0);
	idt_set_desc(26, isr26, 0);
	idt_set_desc(27, isr27, 0);
	idt_set_desc(28, isr28, 0);
	idt_set_desc(29, isr29, 0);
	idt_set_desc(30, isr30, 0);
	idt_set_desc(31, isr31, 0);
	idt_set_desc(32, isr32, 0);
	idt_set_desc(33, isr33, 0);
	idt_set_desc(34, isr34, 0);
	idt_set_desc(35, isr35, 0);
	idt_set_desc(36, isr36, 0);
	idt_set_desc(37, isr37, 0);
	idt_set_desc(38, isr38, 0);
	idt_set_desc(39, isr39, 0);
	idt_set_desc(40, isr40, 0);
	idt_set_desc(41, isr41, 0);
	idt_set_desc(42, isr42, 0);
	idt_set_desc(43, isr43, 0);
	idt_set_desc(44, isr44, 0);
	idt_set_desc(45, isr45, 0);
	idt_set_desc(46, isr46, 0);
	idt_set_desc(47, isr47, 0);
	idt_set_desc(48, isr48, 1);
	idt_set_desc(49, isr49, 0);
	idt_set_desc(50, isr50, 0);
	idt_set_desc(51, isr51, 0);
	idt_set_desc(52, isr52, 0);
	idt_set_desc(53, isr53, 0);
	idt_set_desc(54, isr54, 0);
	idt_set_desc(55, isr55, 0);
	idt_set_desc(56, isr56, 0);
	idt_set_desc(57, isr57, 0);
	idt_set_desc(58, isr58, 0);
	idt_set_desc(59, isr59, 0);
	idt_set_desc(60, isr60, 0);
	idt_set_desc(61, isr61, 0);
	idt_set_desc(62, isr62, 0);
	idt_set_desc(63, isr63, 0);
	idt_set_desc(64, isr64, 0);
	idt_set_desc(65, isr65, 0);
	idt_set_desc(66, isr66, 0);
	idt_set_desc(67, isr67, 0);
	idt_set_desc(68, isr68, 0);
	idt_set_desc(69, isr69, 0);
	idt_set_desc(70, isr70, 0);
	idt_set_desc(71, isr71, 0);
	idt_set_desc(72, isr72, 0);
	idt_set_desc(73, isr73, 0);
	idt_set_desc(74, isr74, 0);
	idt_set_desc(75, isr75, 0);
	idt_set_desc(76, isr76, 0);
	idt_set_desc(77, isr77, 0);
	idt_set_desc(78, isr78, 0);
	idt_set_desc(79, isr79, 0);
	idt_set_desc(80, isr80, 0);
	idt_set_desc(81, isr81, 0);
	idt_set_desc(82, isr82, 0);
	idt_set_desc(83, isr83, 0);
	idt_set_desc(84, isr84, 0);
	idt_set_desc(85, isr85, 0);
	idt_set_desc(86, isr86, 0);
	idt_set_desc(87, isr87, 0);
	idt_set_desc(88, isr88, 0);
	idt_set_desc(89, isr89, 0);
	idt_set_desc(90, isr90, 0);
	idt_set_desc(91, isr91, 0);
	idt_set_desc(92, isr92, 0);
	idt_set_desc(93, isr93, 0);
	idt_set_desc(94, isr94, 0);
	idt_set_desc(95, isr95, 0);
	idt_set_desc(96, isr96, 0);
	idt_set_desc(97, isr97, 0);
	idt_set_desc(98, isr98, 0);
	idt_set_desc(99, isr99, 0);
	idt_set_desc(100, isr100, 0);
	idt_set_desc(101, isr101, 0);
	idt_set_desc(102, isr102, 0);
	idt_set_desc(103, isr103, 0);
	idt_set_desc(104, isr104, 0);
	idt_set_desc(105, isr105, 0);
	idt_set_desc(106, isr106, 0);
	idt_set_desc(107, isr107, 0);
	idt_set_desc(108, isr108, 0);
	idt_set_desc(109, isr109, 0);
	idt_set_desc(110, isr110, 0);
	idt_set_desc(111, isr111, 0);
	idt_set_desc(112, isr112, 0);
	idt_set_desc(113, isr113, 0);
	idt_set_desc(114, isr114, 0);
	idt_set_desc(115, isr115, 0);
	idt_set_desc(116, isr116, 0);
	idt_set_desc(117, isr117, 0);
	idt_set_desc(118, isr118, 0);
	idt_set_desc(119, isr119, 0);
	idt_set_desc(120, isr120, 0);
	idt_set_desc(121, isr121, 0);
	idt_set_desc(122, isr122, 0);
	idt_set_desc(123, isr123, 0);
	idt_set_desc(124, isr124, 0);
	idt_set_desc(125, isr125, 0);
	idt_set_desc(126, isr126, 0);
	idt_set_desc(127, isr127, 0);
	idt_set_desc(128, isr128, 0);
	idt_set_desc(129, isr129, 0);
	idt_set_desc(130, isr130, 0);
	idt_set_desc(131, isr131, 0);
	idt_set_desc(132, isr132, 0);
	idt_set_desc(133, isr133, 0);
	idt_set_desc(134, isr134, 0);
	idt_set_desc(135, isr135, 0);
	idt_set_desc(136, isr136, 0);
	idt_set_desc(137, isr137, 0);
	idt_set_desc(138, isr138, 0);
	idt_set_desc(139, isr139, 0);
	idt_set_desc(140, isr140, 0);
	idt_set_desc(141, isr141, 0);
	idt_set_desc(142, isr142, 0);
	idt_set_desc(143, isr143, 0);
	idt_set_desc(144, isr144, 0);
	idt_set_desc(145, isr145, 0);
	idt_set_desc(146, isr146, 0);
	idt_set_desc(147, isr147, 0);
	idt_set_desc(148, isr148, 0);
	idt_set_desc(149, isr149, 0);
	idt_set_desc(150, isr150, 0);
	idt_set_desc(151, isr151, 0);
	idt_set_desc(152, isr152, 0);
	idt_set_desc(153, isr153, 0);
	idt_set_desc(154, isr154, 0);
	idt_set_desc(155, isr155, 0);
	idt_set_desc(156, isr156, 0);
	idt_set_desc(157, isr157, 0);
	idt_set_desc(158, isr158, 0);
	idt_set_desc(159, isr159, 0);
	idt_set_desc(160, isr160, 0);
	idt_set_desc(161, isr161, 0);
	idt_set_desc(162, isr162, 0);
	idt_set_desc(163, isr163, 0);
	idt_set_desc(164, isr164, 0);
	idt_set_desc(165, isr165, 0);
	idt_set_desc(166, isr166, 0);
	idt_set_desc(167, isr167, 0);
	idt_set_desc(168, isr168, 0);
	idt_set_desc(169, isr169, 0);
	idt_set_desc(170, isr170, 0);
	idt_set_desc(171, isr171, 0);
	idt_set_desc(172, isr172, 0);
	idt_set_desc(173, isr173, 0);
	idt_set_desc(174, isr174, 0);
	idt_set_desc(175, isr175, 0);
	idt_set_desc(176, isr176, 0);
	idt_set_desc(177, isr177, 0);
	idt_set_desc(178, isr178, 0);
	idt_set_desc(179, isr179, 0);
	idt_set_desc(180, isr180, 0);
	idt_set_desc(181, isr181, 0);
	idt_set_desc(182, isr182, 0);
	idt_set_desc(183, isr183, 0);
	idt_set_desc(184, isr184, 0);
	idt_set_desc(185, isr185, 0);
	idt_set_desc(186, isr186, 0);
	idt_set_desc(187, isr187, 0);
	idt_set_desc(188, isr188, 0);
	idt_set_desc(189, isr189, 0);
	idt_set_desc(190, isr190, 0);
	idt_set_desc(191, isr191, 0);
	idt_set_desc(192, isr192, 0);
	idt_set_desc(193, isr193, 0);
	idt_set_desc(194, isr194, 0);
	idt_set_desc(195, isr195, 0);
	idt_set_desc(196, isr196, 0);
	idt_set_desc(197, isr197, 0);
	idt_set_desc(198, isr198, 0);
	idt_set_desc(199, isr199, 0);
	idt_set_desc(200, isr200, 0);
	idt_set_desc(201, isr201, 0);
	idt_set_desc(202, isr202, 0);
	idt_set_desc(203, isr203, 0);
	idt_set_desc(204, isr204, 0);
	idt_set_desc(205, isr205, 0);
	idt_set_desc(206, isr206, 0);
	idt_set_desc(207, isr207, 0);
	idt_set_desc(208, isr208, 0);
	idt_set_desc(209, isr209, 0);
	idt_set_desc(210, isr210, 0);
	idt_set_desc(211, isr211, 0);
	idt_set_desc(212, isr212, 0);
	idt_set_desc(213, isr213, 0);
	idt_set_desc(214, isr214, 0);
	idt_set_desc(215, isr215, 0);
	idt_set_desc(216, isr216, 0);
	idt_set_desc(217, isr217, 0);
	idt_set_desc(218, isr218, 0);
	idt_set_desc(219, isr219, 0);
	idt_set_desc(220, isr220, 0);
	idt_set_desc(221, isr221, 0);
	idt_set_desc(222, isr222, 0);
	idt_set_desc(223, isr223, 0);
	idt_set_desc(224, isr224, 0);
	idt_set_desc(225, isr225, 0);
	idt_set_desc(226, isr226, 0);
	idt_set_desc(227, isr227, 0);
	idt_set_desc(228, isr228, 0);
	idt_set_desc(229, isr229, 0);
	idt_set_desc(230, isr230, 0);
	idt_set_desc(231, isr231, 0);
	idt_set_desc(232, isr232, 0);
	idt_set_desc(233, isr233, 0);
	idt_set_desc(234, isr234, 0);
	idt_set_desc(235, isr235, 0);
	idt_set_desc(236, isr236, 0);
	idt_set_desc(237, isr237, 0);
	idt_set_desc(238, isr238, 0);
	idt_set_desc(239, isr239, 0);
	idt_set_desc(240, isr240, 0);
	idt_set_desc(241, isr241, 0);
	idt_set_desc(242, isr242, 0);
	idt_set_desc(243, isr243, 0);
	idt_set_desc(244, isr244, 0);
	idt_set_desc(245, isr245, 0);
	idt_set_desc(246, isr246, 0);
	idt_set_desc(247, isr247, 0);
	idt_set_desc(248, isr248, 0);
	idt_set_desc(249, isr249, 0);
	idt_set_desc(250, isr250, 0);
	idt_set_desc(251, isr251, 0);
	idt_set_desc(252, isr252, 0);
	idt_set_desc(253, isr253, 0);
	idt_set_desc(254, isr254, 0);
	idt_set_desc(255, isr255, 0);
    idt_reload();
}

static event_handlers_t event_handlers[256] = {NULL};

void isr_set_handler(int n, void* handler) 
{
	event_handlers[n] = handler;
}

void isr_handle(registers_t* r)
{
    if (r->isr_number < 32)
    {
        // TODO: error messages
        for (;;)
            ;
    }
    
    return event_handlers[r->isr_number](r);
}

